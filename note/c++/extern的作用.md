一般而言，c++全局变量的作用范围仅限于当前的文件，但同时c++也支持分离式编译，允许将程序分割为若干个文件被独立编译。
当需要进行分离式编译时就需要在文件之间共享变量数据，这里extern就发挥了作用。
extern用于指示变量或函数的定义在另一个源文件中，并在当前源文件中声明。
也就是告诉编译器：这个符号在别处定义了，等编译的时候链接器会去链接的地址去找该符号的定义。

## 1.符号的声明与定义

编程语言中变量的声明和定义是两个不同的概念。

声明是指告诉编译器某个符号的存在，在程序变量表中记录类型和名字，声明通常出现在头文件中，以便在多个源文件中共享。
例如：
```cpp
extern int x;  // 变量声明，不分配内存
int add(int a, int b);  // 函数声明，不提供实现
class MyClass;  // 类声明，不定义其成员
```
在这个示例中的x变量的声明使用了extern关键字告诉编译器它的定义在其他源文件中

而定义则是指为该符号分配内存空间或实现其代码逻辑。
例如：
```cpp
int x = 10;  // 变量定义，分配内存并初始化
int add(int a, int b) {  // 函数定义，提供实现
    return a + b;
}
class MyClass {  // 类定义，定义其成员
public:
    void display();
};
```


## 2.c++中链接属性

在c++中，链接属性是指程序在编译、链接和执行阶段如何处理符号的可见性和重复定义。c++中具有以下链接属性

### 2.1外部链接（Extern Linkage）

外部链接的符号可以在不同的源文件之间共享，并且在整个程序执行期间可见。全局变量和函数都具有外部链接

### 2.2内部链接（Internal Linkage）

内部链接的符号只能在当前源文件内部使用，不能被其他源文件访问。用static修饰的全局变量和函数具有内部链接

### 2.3无链接

无链接的符号只能在当前代码块内部使用，不能被其他函数或代码块访问。用const或consterpr修饰的常量具有无链接属性（

### 2.4 外部c链接

外部c链接的符号与外部链接类似，可以在不同的源文件之间共享，并且在整个程序执行期间可见。
他们具有c语言的名称和调用约定，可以与c语言编写的代码进行交互
在c++中可以使用extern C关键字来制定外部c链接


## 3.Extern的作用

### 3.1 声明变量但不定义

声明变量或函数的存在，但不进行定义，让编译器在链接时在其他源文件中查找定义。
这使得不同的源文件可以共享相同的变量或函数。
当链接器在一个全局变量声明前看到extern关键字，它会尝试在其他文件中寻找这个变量的定义
这里强调全局变量的原因是全局变量默认是外部链接的
例：
```cpp
//fileA.cpp
int i = 1;         //声明并定义全局变量i

//fileB.cpp
extern int i;    //声明i，链接全局变量

//fileC.cpp
extern int i = 2;        //错误，多重定义
int i;                    //错误，这是一个定义，导致多重定义
main()
{
    extern int i;        //正确
    int i = 5;            //正确，新的局部变量i，这里局部变量会隐藏全局变量;
}
```

### 3.2 全局常量的外部链接

全局常量默认是内部链接的，所以想要在文件间传递全局常量需要在定义时指明extern，如下
```cpp
//fileA.cpp
extern const int i = 1;        //定义

//fileB.cpp                    //声明
extern const int i;
```

而下面这种用法则会报链接错误，找不到i的定义

```cpp
//fileA.cpp
const int i = 1;        //定义 (不用 extern 修饰)

//fileB.cpp                    //声明
extern const int i;
```

### 3.3编译和链接过程

编译链接过程中，extern的作用如下：

- 在编译期，extern用于高速编译器某个变量或函数的定义在其他源文件中，编译器会为它生成一个符号表项，并在当前源文件中建立一个对该符号的引用
- 在链接期，链接器会将多个目标合并成一个可执行文件，并且在当前源文件中声明的符号，会在其他源文件中找到对应的定义，并将他们链接起来
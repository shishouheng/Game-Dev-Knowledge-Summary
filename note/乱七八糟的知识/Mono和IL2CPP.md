
# 1.Unity是如何实现跨平台的

Unity是通过Mono或者IL2CPP这两种脚本后处理方式实现跨平台的，同一份代码可以在不同的平台上生成相应的机器码，以此实现跨平台。

# 2.跨平台机制的分类

跨平台主要有三种机制，分别是：AOT、JIT和脚本语言的解释器

 - AOT（Ahead of Time Compilation）:预编译，它在程序运行之前将源代码编译成目标平台的机器码，如C/C++都是通过AOT实现跨平台的，直接将源代码编译成目标平台的Native Code
 - JIT（Just-in-Time Compilation）：即时编译，会将源代码编译为某种中间语言（如JAVA的字节码和C#的CIL），然后在程序运行时即时编译为目标平台的Native Code然后执行
 - 解释器：如Python/Lua之类的脚本语言，源代码并不会编译为Native Code，而是会通过解释器在运行时根据脚本语言的语法和语义规则逐行解释源代码并转换为对应的机器码

一般就性能而言AOT>JIT>解释器


# 3.Unity的跨平台机制

## 3.1 CIL和CLR

.Net标准定义了所谓的CIL标准，可以将各种语言编译成统一的CIL语言，然后运行在各个平台的CLR上（可以理解为支持CIL语言运行的虚拟机）

## 3.2 Mono（JIT）

Mono就是一种对于CIL和CLR的实现，核心就是将各种高级语言编译成IL的编译器以及运行IL的CLR。Unity最开始的跨平台就是通过Mono实现的，如C#语言就会通过Mono被编译器编译为IL中间语言，然后在各个平台上的Mono虚拟机上运行，实现了跨平台机制。

但由于ios禁止JIT的使用，以及针对于不同的平台都需要单独实现对应的Mono虚拟机，维护成本较高，Mono已经较少被使用


## 3.3 IL2CPP（AOT）

IL2CPP是Unity支持的另一种脚本后处理方式，与Mono不同的是，编译器生成中间语言之后会将IL转换为C++，然后再通过各个平台的编译器编译成相应的Native Code。

由于IL2CPP是在运行之前将IL代码转换为本地平台的c++代码，而不是在运行时动态的将IL代码编译成机器码，避免了JIT运行时的编译开销，所以相对来说性能较高。

